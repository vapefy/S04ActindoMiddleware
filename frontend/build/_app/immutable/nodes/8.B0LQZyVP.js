import{c as oe,a as o,f as k,t as U,s as q}from"../chunks/B35PcQGF.js";import{o as Oe}from"../chunks/lRhbJWai.js";import{f as h,p as Ue,s as _,c as De,d as He,e as Ge,j as t,u as $e,g as a,$ as Ke,i as r,n as p,t as J,k as n,r as s,ai as Ze}from"../chunks/BZjX7xHU.js";import{l as ie,s as de,i as D,a as qe,b as Je}from"../chunks/D9uJM2wH.js";import{I as ce,s as ve,h as Qe,l as _e,e as We,g as Xe,i as Ye}from"../chunks/DQl7avGA.js";import{g as et}from"../chunks/DCM3-_mG.js";import{p as tt}from"../chunks/BAylat5N.js";import{f as at}from"../chunks/BWqZDye-.js";import{P as rt,R as st}from"../chunks/CP3XHTay.js";import{A as Pe,C as ne}from"../chunks/kp9I4jKG.js";import{B as he}from"../chunks/D5w3vmtt.js";import{I as B}from"../chunks/x5lqHpA1.js";import{S as nt}from"../chunks/BMMDD9hE.js";import{B as le}from"../chunks/DAS_cPG8.js";import"../chunks/_G6KF_sA.js";import{S as lt}from"../chunks/DZ7fo_3M.js";import{T as ot}from"../chunks/BP1l7xaz.js";function it(z,f){const E=ie(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]];ce(z,de({name:"globe"},()=>E,{get iconNode(){return w},children:(S,H)=>{var d=oe(),m=h(d);ve(m,f,"default",{}),o(S,d)},$$slots:{default:!0}}))}function dt(z,f){const E=ie(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"}],["path",{d:"m21 2-9.6 9.6"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5"}]];ce(z,de({name:"key"},()=>E,{get iconNode(){return w},children:(S,H)=>{var d=oe(),m=h(d);ve(m,f,"default",{}),o(S,d)},$$slots:{default:!0}}))}function ct(z,f){const E=ie(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}]];ce(z,de({name:"link"},()=>E,{get iconNode(){return w},children:(S,H)=>{var d=oe(),m=h(d);ve(m,f,"default",{}),o(S,d)},$$slots:{default:!0}}))}function vt(z,f){const E=ie(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];ce(z,de({name:"save"},()=>E,{get iconNode(){return w},children:(S,H)=>{var d=oe(),m=h(d);ve(m,f,"default",{}),o(S,d)},$$slots:{default:!0}}))}var ut=k("<!> Aktualisieren",1),pt=k('<div class="flex justify-center py-12"><!></div>'),ft=k('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> OAuth Credentials</h3> <div class="space-y-4"><div><label class="label" for="token-endpoint">Token Endpoint</label> <!></div> <div><label class="label" for="client-id">Client ID</label> <!></div> <div><label class="label" for="client-secret">Client Secret</label> <!></div></div>',1),mt=k("<!> Tokens loeschen",1),$t=k('<p class="text-sm text-gray-500"> </p>'),_t=k('<div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold flex items-center gap-2"><!> Token Status</h3> <!></div> <div class="space-y-4"><div class="p-4 rounded-xl bg-black/20 border border-white/10"><div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">Access Token</span> <!></div> <!></div> <div class="p-4 rounded-xl bg-black/20 border border-white/10"><div class="flex items-center justify-between"><span class="text-sm text-gray-400">Refresh Token</span> <!></div></div> <div><label class="label" for="access-token">Access Token (manuell)</label> <!></div> <div><label class="label" for="refresh-token">Refresh Token (manuell)</label> <!></div></div>',1),ht=k('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> NAV API Einstellungen</h3> <div class="grid sm:grid-cols-2 gap-4"><div><label class="label" for="nav-api-url">NAV API URL</label> <!> <p class="text-xs text-gray-500 mt-1">Endpoint fuer NAV API Aufrufe</p></div> <div><label class="label" for="nav-api-token">NAV API Token</label> <!> <p class="text-xs text-gray-500 mt-1">Bearer Token fuer die Authentifizierung</p></div></div>',1),gt=k('<div><label class="label"> </label> <!></div>'),bt=k('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> Actindo Endpoints</h3> <div class="grid sm:grid-cols-2 gap-4"></div>',1),kt=k("<!> ",1),xt=k('<div class="grid lg:grid-cols-2 gap-6"><!> <!> <!> <!></div> <div class="flex justify-end mt-6"><!></div>',1),yt=k("<!> <!> <!> <!>",1);function Ot(z,f){Ue(f,!0);const E=()=>Je(tt,"$permissions",w),[w,S]=qe();let H=$e(E),d=_(null),m=_(!0),Q=_(!1),V=_(""),F=_(""),W=_(""),X=_(""),Y=_(""),L=_(""),O=_(""),G=_(De({})),ee=_(""),te=_("");Oe(()=>{if(!t(H).isAdmin){et("/");return}ae()});async function ae(){a(m,!0),a(V,"");try{const e=await _e.get();a(d,e,!0),a(W,e.clientId??"",!0),a(X,e.clientSecret??"",!0),a(Y,e.tokenEndpoint??"",!0),a(L,e.accessToken??"",!0),a(O,e.refreshToken??"",!0),a(G,{...e.endpoints},!0),a(ee,e.navApiUrl??"",!0),a(te,e.navApiToken??"",!0)}catch(e){a(V,e instanceof Error?e.message:"Fehler beim Laden",!0)}finally{a(m,!1)}}async function ze(){var e;a(Q,!0),a(V,""),a(F,"");try{await _e.update({clientId:t(W)||null,clientSecret:t(X)||null,tokenEndpoint:t(Y)||null,accessToken:t(L)||null,accessTokenExpiresAt:((e=t(d))==null?void 0:e.accessTokenExpiresAt)??null,refreshToken:t(O)||null,endpoints:t(G),navApiUrl:t(ee)||null,navApiToken:t(te)||null}),a(F,"Einstellungen gespeichert"),ae()}catch(c){a(V,c instanceof Error?c.message:"Fehler beim Speichern",!0)}finally{a(Q,!1)}}async function Ee(){if(confirm("OAuth-Tokens wirklich zuruecksetzen?"))try{await _e.resetTokens(),a(L,""),a(O,""),a(F,"Tokens zurueckgesetzt"),ae()}catch(e){a(V,e instanceof Error?e.message:"Fehler beim Zuruecksetzen",!0)}}function we(e,c){a(G,{...t(G),[e]:c},!0)}var ge=yt();Qe("1i19ct2",e=>{Ge(()=>{Ke.title="Settings | Actindo Middleware"})});var be=h(ge);rt(be,{title:"Einstellungen",subtitle:"Actindo OAuth und API-Konfiguration",actions:c=>{he(c,{variant:"ghost",onclick:ae,get disabled(){return t(m)},children:(I,N)=>{var K=ut(),re=h(K);{let ue=$e(()=>t(m)?"animate-spin":"");st(re,{size:16,get class(){return t(ue)}})}p(),o(I,K)},$$slots:{default:!0}})}});var ke=r(be,2);{var Se=e=>{Pe(e,{variant:"error",class:"mb-6",dismissible:!0,ondismiss:()=>a(V,""),children:(c,I)=>{p();var N=U();J(()=>q(N,t(V))),o(c,N)},$$slots:{default:!0}})};D(ke,e=>{t(V)&&e(Se)})}var xe=r(ke,2);{var Ie=e=>{Pe(e,{variant:"success",class:"mb-6",dismissible:!0,ondismiss:()=>a(F,""),children:(c,I)=>{p();var N=U();J(()=>q(N,t(F))),o(c,N)},$$slots:{default:!0}})};D(xe,e=>{t(F)&&e(Ie)})}var Ne=r(xe,2);{var Me=e=>{var c=pt(),I=n(c);nt(I,{size:"large"}),s(c),o(e,c)},Ve=e=>{var c=xt(),I=h(c),N=n(I);ne(N,{children:(M,se)=>{var u=ft(),i=h(u),x=n(i);dt(x,{size:20}),p(),s(i);var T=r(i,2),y=n(T),j=r(n(y),2);B(j,{id:"token-endpoint",placeholder:"https://...",get value(){return t(Y)},set value(b){a(Y,b,!0)}}),s(y);var $=r(y,2),g=r(n($),2);B(g,{id:"client-id",placeholder:"Client ID",get value(){return t(W)},set value(b){a(W,b,!0)}}),s($);var P=r($,2),C=r(n(P),2);B(C,{id:"client-secret",type:"password",placeholder:"********",get value(){return t(X)},set value(b){a(X,b,!0)}}),s(P),s(T),o(M,u)},$$slots:{default:!0}});var K=r(N,2);ne(K,{children:(M,se)=>{var u=_t(),i=h(u),x=n(i),T=n(x);lt(T,{size:20}),p(),s(x);var y=r(x,2);he(y,{variant:"danger",size:"small",onclick:Ee,children:(l,v)=>{var R=mt(),A=h(R);ot(A,{size:14}),p(),o(l,R)},$$slots:{default:!0}}),s(i);var j=r(i,2),$=n(j),g=n($),P=r(n(g),2);{var C=l=>{le(l,{variant:"success",children:(v,R)=>{p();var A=U("Vorhanden");o(v,A)},$$slots:{default:!0}})},b=l=>{le(l,{variant:"error",children:(v,R)=>{p();var A=U("Fehlt");o(v,A)},$$slots:{default:!0}})};D(P,l=>{t(L)?l(C):l(b,!1)})}s(g);var pe=r(g,2);{var fe=l=>{var v=$t(),R=n(v);s(v),J(A=>q(R,`Gueltig bis: ${A??""}`),[()=>at(t(d).accessTokenExpiresAt)]),o(l,v)};D(pe,l=>{var v;(v=t(d))!=null&&v.accessTokenExpiresAt&&l(fe)})}s($);var Z=r($,2),Ae=n(Z),Re=r(n(Ae),2);{var Be=l=>{le(l,{variant:"success",children:(v,R)=>{p();var A=U("Vorhanden");o(v,A)},$$slots:{default:!0}})},Ce=l=>{le(l,{variant:"warning",children:(v,R)=>{p();var A=U("Fehlt");o(v,A)},$$slots:{default:!0}})};D(Re,l=>{t(O)?l(Be):l(Ce,!1)})}s(Ae),s(Z);var me=r(Z,2),Fe=r(n(me),2);B(Fe,{id:"access-token",type:"password",placeholder:"Access Token...",get value(){return t(L)},set value(l){a(L,l,!0)}}),s(me);var Te=r(me,2),Le=r(n(Te),2);B(Le,{id:"refresh-token",type:"password",placeholder:"Refresh Token...",get value(){return t(O)},set value(l){a(O,l,!0)}}),s(Te),s(j),o(M,u)},$$slots:{default:!0}});var re=r(K,2);ne(re,{class:"lg:col-span-2",children:(M,se)=>{var u=ht(),i=h(u),x=n(i);it(x,{size:20}),p(),s(i);var T=r(i,2),y=n(T),j=r(n(y),2);B(j,{id:"nav-api-url",placeholder:"https://notify.schalke04.de/nav/test/navapi",get value(){return t(ee)},set value(P){a(ee,P,!0)}}),p(2),s(y);var $=r(y,2),g=r(n($),2);B(g,{id:"nav-api-token",type:"password",placeholder:"Bearer Token...",get value(){return t(te)},set value(P){a(te,P,!0)}}),p(2),s($),s(T),o(M,u)},$$slots:{default:!0}});var ue=r(re,2);ne(ue,{class:"lg:col-span-2",children:(M,se)=>{var u=bt(),i=h(u),x=n(i);ct(x,{size:20}),p(),s(i);var T=r(i,2);We(T,21,()=>Object.entries(t(G)),Ye,(y,j)=>{var $=$e(()=>Ze(t(j),2));let g=()=>t($)[0],P=()=>t($)[1];var C=gt(),b=n(C),pe=n(b,!0);s(b);var fe=r(b,2);B(fe,{get id(){return`endpoint-${g()??""}`},get value(){return P()},oninput:Z=>we(g(),Z.currentTarget.value),placeholder:"https://..."}),s(C),J(()=>{Xe(b,"for",`endpoint-${g()??""}`),q(pe,g())}),o(y,C)}),s(T),o(M,u)},$$slots:{default:!0}}),s(I);var ye=r(I,2),je=n(ye);he(je,{onclick:ze,get disabled(){return t(Q)},children:(M,se)=>{var u=kt(),i=h(u);vt(i,{size:16});var x=r(i);J(()=>q(x,` ${t(Q)?"Speichere...":"Einstellungen speichern"}`)),o(M,u)},$$slots:{default:!0}}),s(ye),o(e,c)};D(Ne,e=>{t(m)&&!t(d)?e(Me):e(Ve,!1)})}o(z,ge),He(),S()}export{Ot as component};
