import{l as s,w as c}from"./BZjX7xHU.js";import{a as r}from"./DQl7avGA.js";function d(){const{subscribe:a,set:e,update:i}=c({user:null,loading:!0,initialized:!1});return{subscribe:a,async init(){i(t=>({...t,loading:!0}));try{const t=await r.me();e({user:t.authenticated?t:null,loading:!1,initialized:!0})}catch{e({user:null,loading:!1,initialized:!0})}},async login(t,n){const l=await r.login({username:t,password:n}),o={authenticated:!0,username:l.username,role:l.role};return e({user:o,loading:!1,initialized:!0}),o},async logout(){await r.logout(),e({user:null,loading:!1,initialized:!0})},setUser(t){i(n=>({...n,user:t}))}}}const u=d(),f=s(u,a=>{var e;return((e=a.user)==null?void 0:e.authenticated)??!1}),h=s(u,a=>a.user),w=s(u,a=>{var i,t;const e=((t=(i=a.user)==null?void 0:i.role)==null?void 0:t.toLowerCase())??"";return{canRead:["read","write","admin"].includes(e),canWrite:["write","admin"].includes(e),isAdmin:e==="admin"}});export{u as a,h as c,f as i,w as p};
