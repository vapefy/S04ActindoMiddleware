import{c as ke,a as i,d as Ne,f as p,s as $,t as se,e as Te}from"../chunks/B35PcQGF.js";import{o as Me}from"../chunks/lRhbJWai.js";import{f as D,p as ze,r,t as R,d as Pe,k as a,j as e,s as P,c as ie,e as Se,i as s,u as de,g as c,$ as qe,n as L}from"../chunks/BZjX7xHU.js";import{l as Ge,s as He,p as ce,i as Y,a as Oe,b as Ke}from"../chunks/D9uJM2wH.js";import{I as We,s as Xe,e as fe,i as me,g as Je,f as Qe,j as Ve,h as Ye,u as le,k as ue}from"../chunks/DQl7avGA.js";import{g as Ze}from"../chunks/DCM3-_mG.js";import{p as et}from"../chunks/BAylat5N.js";import{f as ye}from"../chunks/BWqZDye-.js";import{P as tt,R as rt}from"../chunks/CP3XHTay.js";import{C as ve,A as $e,X as at}from"../chunks/kp9I4jKG.js";import{B as Z}from"../chunks/D5w3vmtt.js";import{I as we}from"../chunks/x5lqHpA1.js";import{B as st}from"../chunks/DAS_cPG8.js";import{S as lt}from"../chunks/BMMDD9hE.js";import"../chunks/_G6KF_sA.js";import{C as ot}from"../chunks/P2UTRTYh.js";import{T as nt}from"../chunks/BP1l7xaz.js";import{C as it}from"../chunks/D1NRD0ur.js";function dt(q,f){const G=Ge(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11"}]];We(q,He({name:"user-plus"},()=>G,{get iconNode(){return H},children:(O,x)=>{var m=ke(),v=D(m);Xe(v,f,"default",{}),i(O,m)},$$slots:{default:!0}}))}var ct=p('<option class="bg-dark-800"> </option>'),ut=p("<select></select>");function pe(q,f){ze(f,!0);let G=ce(f,"value",15,""),H=ce(f,"disabled",3,!1),O=ce(f,"class",3,"");var x=ut();x.__change=function(...m){var v;(v=f.onchange)==null||v.apply(this,m)},fe(x,21,()=>f.options,me,(m,v)=>{var b=ct(),M=a(b,!0);r(b);var A={};R(()=>{$(M,e(v).label),A!==(A=e(v).value)&&(b.value=(b.__value=e(v).value)??"")}),i(m,b)}),r(x),R(()=>{Je(x,"id",f.id),x.disabled=H(),Qe(x,1,`
		w-full px-4 py-2.5 rounded-xl
		bg-black/30 border border-white/10
		text-white outline-none cursor-pointer
		transition-all
		focus:border-royal-400/60 focus:ring-4 focus:ring-royal-400/10
		disabled:opacity-50 disabled:cursor-not-allowed
		${O()??""}
	`)}),Ve(x,G),i(q,x),Pe()}Ne(["change"]);var vt=p("<!> Aktualisieren",1),pt=p('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> Neuer Benutzer</h3> <!> <form class="space-y-4"><div><label class="label" for="new-username">Benutzername</label> <!></div> <div><label class="label" for="new-password">Passwort</label> <!></div> <div><label class="label" for="new-role">Rolle</label> <!></div> <!></form>',1),ft=p('<div class="flex justify-center py-8"><!></div>'),mt=p('<p class="text-center py-8 text-gray-400">Keine Benutzer vorhanden</p>'),gt=p('<tr class="border-b border-white/5"><td class="py-3 px-4 font-medium"> </td><td class="py-3 px-4"><!></td><td class="py-3 px-4 text-sm text-gray-400"> </td><td class="py-3 px-4 text-right"><!></td></tr>'),ht=p('<div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-white/10"><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Benutzer</th><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Rolle</th><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Erstellt</th><th class="text-right py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Aktionen</th></tr></thead><tbody></tbody></table></div>'),_t=p('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> </h3> <!>',1),xt=p("<!> Genehmigen",1),bt=p('<tr class="border-b border-white/5"><td class="py-3 px-4 font-medium"> </td><td class="py-3 px-4 text-sm text-gray-400"> </td><td class="py-3 px-4"><!></td><td class="py-3 px-4"><div class="flex justify-end gap-2"><!> <!></div></td></tr>'),yt=p('<h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><!> Offene Registrierungen</h3> <div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-white/10"><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Benutzer</th><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Angefragt am</th><th class="text-left py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Rolle</th><th class="text-right py-3 px-4 text-xs uppercase tracking-wider text-gray-400">Aktionen</th></tr></thead><tbody></tbody></table></div>',1),$t=p('<!> <!> <div class="grid lg:grid-cols-3 gap-6"><!> <!></div> <!>',1);function qt(q,f){ze(f,!0);const G=()=>Ke(et,"$permissions",H),[H,O]=Oe();let x=de(G),m=P(ie([])),v=P(ie([])),b=P(!0),M=P(""),A=P(""),K=P(""),ee=P("read"),te=P(!1),re=P(""),W=ie({});const oe=[{value:"read",label:"Read"},{value:"write",label:"Write"},{value:"admin",label:"Admin"}];Me(()=>{if(!e(x).isAdmin){Ze("/");return}I()});async function I(){c(b,!0),c(M,"");try{const[t,l]=await Promise.all([le.list(),ue.list()]);c(m,t,!0),c(v,l,!0),l.forEach(d=>{W[d.id]||(W[d.id]="read")})}catch(t){c(M,t instanceof Error?t.message:"Fehler beim Laden",!0)}finally{c(b,!1)}}async function Re(t){if(t.preventDefault(),!(!e(A).trim()||!e(K).trim())){c(te,!0),c(re,"");try{await le.create({username:e(A),password:e(K),role:e(ee)}),c(A,""),c(K,""),c(ee,"read"),I()}catch(l){c(re,l instanceof Error?l.message:"Fehler beim Erstellen",!0)}finally{c(te,!1)}}}async function Ae(t,l){try{await le.setRole(t,{role:l}),I()}catch(d){alert(d instanceof Error?d.message:"Fehler beim Aendern")}}async function Be(t){if(confirm("User wirklich loeschen?"))try{await le.delete(t),I()}catch(l){alert(l instanceof Error?l.message:"Fehler beim Loeschen")}}async function Ee(t,l){try{await ue.approve(t,{role:l}),I()}catch(d){alert(d instanceof Error?d.message:"Fehler beim Genehmigen")}}async function Ce(t){if(confirm("Registrierung ablehnen?"))try{await ue.reject(t),I()}catch(l){alert(l instanceof Error?l.message:"Fehler beim Ablehnen")}}var ge=$t();Ye("9fk07v",t=>{Se(()=>{qe.title="Users | Actindo Middleware"})});var he=D(ge);tt(he,{title:"Benutzerverwaltung",subtitle:"Benutzer und Registrierungen verwalten",actions:l=>{Z(l,{variant:"ghost",onclick:I,get disabled(){return e(b)},children:(d,u)=>{var y=vt(),B=D(y);{let E=de(()=>e(b)?"animate-spin":"");rt(B,{size:16,get class(){return e(E)}})}L(),i(d,y)},$$slots:{default:!0}})}});var _e=s(he,2);{var je=t=>{$e(t,{variant:"error",class:"mb-6",children:(l,d)=>{L();var u=se();R(()=>$(u,e(M))),i(l,u)},$$slots:{default:!0}})};Y(_e,t=>{e(M)&&t(je)})}var ne=s(_e,2),xe=a(ne);ve(xe,{children:(t,l)=>{var d=pt(),u=D(d),y=a(u);dt(y,{size:20}),L(),r(u);var B=s(u,2);{var E=n=>{$e(n,{variant:"error",class:"mb-4",children:(k,F)=>{L();var N=se();R(()=>$(N,e(re))),i(k,N)},$$slots:{default:!0}})};Y(B,n=>{e(re)&&n(E)})}var C=s(B,2),j=a(C),g=s(a(j),2);we(g,{id:"new-username",placeholder:"username",required:!0,get value(){return e(A)},set value(n){c(A,n,!0)}}),r(j);var o=s(j,2),h=s(a(o),2);we(h,{id:"new-password",type:"password",placeholder:"********",required:!0,get value(){return e(K)},set value(n){c(K,n,!0)}}),r(o);var w=s(o,2),X=s(a(w),2);pe(X,{id:"new-role",get options(){return oe},get value(){return e(ee)},set value(n){c(ee,n,!0)}}),r(w);var _=s(w,2);Z(_,{type:"submit",get disabled(){return e(te)},class:"w-full",children:(n,k)=>{L();var F=se();R(()=>$(F,e(te)?"Erstelle...":"Benutzer erstellen")),i(n,F)},$$slots:{default:!0}}),r(C),Te("submit",C,Re),i(t,d)},$$slots:{default:!0}});var Fe=s(xe,2);ve(Fe,{class:"lg:col-span-2",children:(t,l)=>{var d=_t(),u=D(d),y=a(u);ot(y,{size:20});var B=s(y);r(u);var E=s(u,2);{var C=g=>{var o=ft(),h=a(o);lt(h,{}),r(o),i(g,o)},j=g=>{var o=ke(),h=D(o);{var w=_=>{var n=mt();i(_,n)},X=_=>{var n=ht(),k=a(n),F=s(a(k));fe(F,21,()=>e(m),me,(N,U)=>{var S=gt(),J=a(S),z=a(J,!0);r(J);var T=s(J),ae=a(T);pe(ae,{get options(){return oe},get value(){return e(U).role},onchange:V=>Ae(e(U).id,V.currentTarget.value),class:"w-28"}),r(T);var Q=s(T),De=a(Q,!0);r(Q);var be=s(Q),Ie=a(be);Z(Ie,{variant:"danger",size:"small",onclick:()=>Be(e(U).id),children:(V,wt)=>{nt(V,{size:14})},$$slots:{default:!0}}),r(be),r(S),R(V=>{$(z,e(U).username),$(De,V)},[()=>ye(e(U).createdAt)]),i(N,S)}),r(F),r(k),r(n),i(_,n)};Y(h,_=>{e(m).length===0?_(w):_(X,!1)},!0)}i(g,o)};Y(E,g=>{e(b)&&e(m).length===0?g(C):g(j,!1)})}R(()=>$(B,` Benutzer (${e(m).length??""})`)),i(t,d)},$$slots:{default:!0}}),r(ne);var Ue=s(ne,2);{var Le=t=>{ve(t,{class:"mt-6",children:(l,d)=>{var u=yt(),y=D(u),B=a(y);st(B,{variant:"warning",children:(g,o)=>{L();var h=se();R(()=>$(h,e(v).length)),i(g,h)},$$slots:{default:!0}}),L(),r(y);var E=s(y,2),C=a(E),j=s(a(C));fe(j,21,()=>e(v),me,(g,o)=>{var h=bt(),w=a(h),X=a(w,!0);r(w);var _=s(w),n=a(_,!0);r(_);var k=s(_),F=a(k);{let z=de(()=>W[e(o).id]??"read");pe(F,{get options(){return oe},get value(){return e(z)},onchange:T=>W[e(o).id]=T.currentTarget.value,class:"w-28"})}r(k);var N=s(k),U=a(N),S=a(U);Z(S,{size:"small",onclick:()=>Ee(e(o).id,W[e(o).id]??"read"),children:(z,T)=>{var ae=xt(),Q=D(ae);it(Q,{size:14}),L(),i(z,ae)},$$slots:{default:!0}});var J=s(S,2);Z(J,{variant:"danger",size:"small",onclick:()=>Ce(e(o).id),children:(z,T)=>{at(z,{size:14})},$$slots:{default:!0}}),r(U),r(N),r(h),R(z=>{$(X,e(o).username),$(n,z)},[()=>ye(e(o).createdAt)]),i(g,h)}),r(j),r(C),r(E),i(l,u)},$$slots:{default:!0}})};Y(Ue,t=>{e(v).length>0&&t(Le)})}i(q,ge),Pe(),O()}export{qt as component};
