import{w as n}from"./BZjX7xHU.js";import{d as r}from"./DQl7avGA.js";const c=6e4;function u(){const{subscribe:s,set:d,update:a}=n({summary:null,loading:!1,error:null});let t=null;return{subscribe:s,async load(){a(e=>({...e,loading:!0,error:null}));try{const e=await r.summary();d({summary:e,loading:!1,error:null})}catch(e){a(l=>({...l,loading:!1,error:e instanceof Error?e.message:"Fehler beim Laden"}))}},startPolling(){t||(this.load(),t=setInterval(()=>{this.load()},c))},stopPolling(){t&&(clearInterval(t),t=null)},clear(){this.stopPolling(),d({summary:null,loading:!1,error:null})}}}function b(){const{subscribe:s,set:d,update:a}=n({jobs:[],total:0,page:1,pageSize:20,search:"",statusFilter:"all",typeFilter:"all",selectedJobId:null,loading:!1,error:null});let t;return s(e=>t=e),{subscribe:s,async load(){a(e=>({...e,loading:!0,error:null}));try{const e=await r.jobs({limit:t.pageSize,page:t.page,search:t.search||void 0,onlyFailed:t.statusFilter==="failed"?!0:t.statusFilter==="success"?!1:void 0,type:t.typeFilter!=="all"?t.typeFilter:void 0});a(l=>{var o;return{...l,jobs:e.jobs,total:e.total,loading:!1,error:null,selectedJobId:l.selectedJobId&&e.jobs.some(i=>i.id===l.selectedJobId)?l.selectedJobId:((o=e.jobs[0])==null?void 0:o.id)??null}})}catch(e){a(l=>({...l,loading:!1,error:e instanceof Error?e.message:"Fehler beim Laden"}))}},setPage(e){a(l=>({...l,page:e})),this.load()},setSearch(e){a(l=>({...l,search:e,page:1})),this.load()},setStatusFilter(e){a(l=>({...l,statusFilter:e,page:1})),this.load()},setTypeFilter(e){a(l=>({...l,typeFilter:e,page:1})),this.load()},selectJob(e){a(l=>({...l,selectedJobId:e}))},async deleteJob(e){await r.deleteJob(e),a(l=>{var o;return{...l,jobs:l.jobs.filter(i=>i.id!==e),total:Math.max(0,l.total-1),selectedJobId:l.selectedJobId===e?((o=l.jobs[0])==null?void 0:o.id)??null:l.selectedJobId}})},async deleteAllJobs(){await r.deleteAllJobs(),a(e=>({...e,jobs:[],total:0,selectedJobId:null}))},async replayJob(e,l){return await r.replayJob(e,l)}}}const h=u(),m=b();export{h as d,m as j};
